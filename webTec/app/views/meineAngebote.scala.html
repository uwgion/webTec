@(myRoutes:  ArrayList[Route])(myRequests: ArrayList[Request])

@main("HÃ¶riMit") {

	<fieldset>
	<legend>Angebotene Mitfahrgelegenheiten</legend>
	<div id="omm_thema-table" class="panel-group">
		
		@for((key) <- myRoutes){
			<div class="panel panel-default" id="@{key._id}">
				<div class="panel-heading">
				  <h4 class="panel-title">
				    <a data-toggle="collapse" data-parent="#omm_thema-table" href="#@{key._id}1">
				     <span class="omm_von">Von:</span> @{key.startAdresse.fetch().name} <span class="omm_nach">Nach:</span> @{key.zielAdresse.fetch().name}
				    </a>
				  </h4>
				</div>
				<div class="panel-collapse collapse" id="@{key._id}1">
					<div class="panel-body">
							@_displayOffer(key)("owner")("6")	
							</div>						
						</div>
			 		</div>
			 	</div>
		 	</div>
		}
	</fieldset>
	<div class="row"></div>
	<fieldset>
	<legend>Angefragte Mitfahrgelegenheiten</legend>
	<div id="omm_thema-table" class="panel-group">
		
		@for((key) <- myRequests){
			<div class="panel panel-default" id="@{key.route.fetch()._id}">
				<div class="panel-heading">
				  <h4 class="panel-title">
				    <a data-toggle="collapse" data-parent="#omm_thema-table" href="#@{key._id}2">
				     <span class="omm_von">Von:</span> @{key.route.fetch().startAdresse.fetch().name} <span class="omm_nach">Nach:</span> @{key.route.fetch().zielAdresse.fetch().name}
				    </a>
				  </h4>
				</div>
				<div class="panel-collapse collapse" id="@{key._id}2">
					<div class="panel-body">
							@_displayOffer(key.route.fetch())("")("6")	
							</div>						
						</div>
			 		</div>
			 	</div>
		 	</div>
		}
	</fieldset>
<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAjsbaoEWBxF2oxvLEenqLjERjfJICyyWg&sensor=true">
</script>

	<script type="text/javascript">

		$(".omm_delete-entry").click(function(event){
			if (confirm('Diese Mitfahrgelegenheit wirklich löschen?')) {
				var id = $(this).parent().find(".omm_value-offer").val();

				jsRoutes.controllers.Angebote.destroyOffer(id).ajax({
			        type:"DELETE",
			        success: function(){
			        		$("#"+id).remove();
			        		$(".alert-success").remove();
			        		$(".omm_content").prepend('<div class="alert alert-success"><i class="glyphicon glyphicon-remove"></i> &nbsp;Angebot erfolgreich gelöscht.</div>');
			        	}
			        });
				}
		});
		$(".panel-title").click(function(event){
			var map;
		    function initialize() {

		        var mapOptions = {
		        center: new google.maps.LatLng(47.693934,8.946791),
		        zoom: 13,
		            mapTypeId: google.maps.MapTypeId.ROADMAP
		    	};
				
		        var eventID = $(event.target).parents(".panel.panel-default").attr('id');
		        console.log(eventID);
		       	map = new google.maps.Map(document.getElementById("map-canvas"+eventID), mapOptions);

				var tempAddress= $('#'+eventID).find('.omm_start-address').val().split("/");
				
				var lat = tempAddress[0];
				var lng = tempAddress[1];
				var start = new google.maps.LatLng(lng, lat);
				tempAddress= $('#'+eventID).find(".omm_destination-address").val().split("/");

				lat = tempAddress[0];
				lng = tempAddress[1];
				var end = new google.maps.LatLng(lng, lat);

				var waypointsLatLng = $('#'+eventID).find('.omm_waypoints-address').val().split("//");

				var waypoints = new Array();

				 //iterate over markers for routes
				for (var i=0;i<waypointsLatLng.length-1;i++){
					var waypoint = waypointsLatLng[i].split("/");
					waypoints.push({location:new google.maps.LatLng(waypoint[1], waypoint[0]),stopover:true})
				}
				 var request = {
					origin:start,
					destination:end,
					 waypoints: waypoints,
					travelMode: google.maps.TravelMode.DRIVING
					};
				calcRoute(request, map);
		    }

		    function calcRoute(request, map){
		    	 var directionsDisplay;
		    	 var directionsService = new google.maps.DirectionsService();
		    	  
		    	 directionsDisplay = new google.maps.DirectionsRenderer();
		    	 directionsDisplay.setMap(map);
		    	 directionsService.route(request, function(result, status) {
		    		    if (status == google.maps.DirectionsStatus.OK) {
		    		      	directionsDisplay.setDirections(result);
		    		      	
		  		       		google.maps.event.addListenerOnce(map, 'idle', function() {
		 		       	   		google.maps.event.trigger(map, 'resize');
		 		       	   		var bounds = result.routes[0].bounds;
		    		      		map.fitBounds(bounds);
		    		      		map.setCenter(bounds.getCenter());
		 		       		});
		    		    }else{

		    		       console.log("route failed. status:" +status +" result:" +result);
		    		    }
		    		  });
		    }
		    initialize();
		});
	
	</script>
}