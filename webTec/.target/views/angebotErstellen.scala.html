@(Routes:  ArrayList[Route])(angebotForm: Form[Route])(fixedPoints: HashMap[String, String])

@import helper._
@import helper.twitterBootstrap._

@main("HÃ¶riMit") {
<div class="starter-template">
    <h1>Aktuelle Angebote</h1>
</div>
	<div class="row">
		     @helper.form(action = routes.Angebote.createRoute, 'class -> "col-md-4 form-group") {
		       
		        <fieldset>
		            <legend>Kontodetails</legend>
		            
		            @inputText(
		                angebotForm("startAdresseForm"), 
		                'placeholder -> "Bitte eine Zieladresse eingeben.",
		                'class -> "form-control",
		                '_label -> "Startadresse", 
		                '_error -> angebotForm.error("startAdresse")
		            )
		            @select(
						angebotForm("startAdresseFormSelect"),
						options = options(fixedPoints),
						'class -> "form-control",				
						'_label -> "Von",
	                	'_default -> "Bitte auswählen."
					)
		            
					<div id="wegpunkte"></div>
		            
		            @inputText(
		                angebotForm("zielAdresseForm"), 
		                'placeholder -> "Bitte eine Startadresse eingeben.",
		                'class -> "form-control",
		                '_label -> "Zieladresse", 
		                '_error -> angebotForm.error("zielAdresse")
		            )
		            
		           	@select(
						angebotForm("zielAdresseFormSelect"),
						options = options(fixedPoints),
						'class -> "form-control",				
						'_label -> "Nach",
	                	'_default -> "Bitte auswählen."
					)
					
		            @inputText(
		                angebotForm("timeForm"), 
		                'placeholder -> "Bitte eine Uhrzeit eingeben im Format hh:mm",
		                'class -> "form-control",
		                '_label -> "Zeit", 
		                '_error -> angebotForm.error("zeit")
		            )
		            @inputDate(
		                angebotForm("dateForm"), 
		                'placeholder -> "Bitte ein Datum eingeben im Format tt.mm.yyyy",
		                'class -> "form-control",
		                '_label -> "Datum", 
		                '_error -> angebotForm.error("datum")
		            )
		            @inputText(
		                angebotForm("seats"), 
						'placeholder -> "Verfügbare Sitzplätze",
		                'class -> "form-control",
		                'type -> "number",
		                'max -> "9",
		                'min -> "1",
		                '_label -> "Sitzplätze", 
		                '_error -> angebotForm.error("seats")
		            )
		        </fieldset>
		        <div class="actions">
					<input type="submit" class="btn btn-default" value="Mitfahrgelegenheit eintragen.">
					<input type="button" id="wegPunkteHinzufuegen" class="btn btn-default" value="Wegpunkte hinfzufügen."></button>
				</div>
		
		    }
		<div class="col-md-8 form-group" style="height:630px" id="map-canvas"></div>

    </div>

<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAjsbaoEWBxF2oxvLEenqLjERjfJICyyWg&sensor=true">
</script>
<script type="text/javascript">
    function initializeMap() {
        var mapOptions = {
        center: new google.maps.LatLng(47.693934,8.946791),
        zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP
    	};
        var map = new google.maps.Map(document.getElementById("map-canvas"),
        mapOptions);
       // google.maps.event.addListener(map, 'click', function(event) {
         //   placeMarker(event.latLng, map);
      //  });

		@if(Routes != null){
			//iterate over routes
			 @for(x <- 0 until Routes.size()){
				var lat = @Routes.get(x).startAdresse.fetch().latitude();
				var lng = @Routes.get(x).startAdresse.fetch().longitude();
				var start = new google.maps.LatLng(lng, lat);
				console.log(lat + ","+ lng);
				lat = @Routes.get(x).zielAdresse.fetch().latitude();
				lng = @Routes.get(x).zielAdresse.fetch().longitude();
				var end = new google.maps.LatLng(lng, lat);
				console.log(lat + ","+ lng);
				var waypoint;
				 //iterate over markers for routes
				 
				 
				 var request = {
					origin:start,
					destination:end,
					waypoints: [
								@for(z <- 0 until Routes.get(x).wegpunkte.size()){
									@{
										  "{ location: new google.maps.LatLng("+Routes.get(x).wegpunkte.get(z).fetch.longitude()+
												  ","+ Routes.get(x).wegpunkte.get(z).fetch.latitude()+
												  "), stopover:true },"
										}
								}
					          ],
					travelMode: google.maps.TravelMode.DRIVING
				};
	         }
			calcRoute(request, map);
		}

	    

    }

    function calcRoute(request, map){
    	 var directionsDisplay;
    	 var directionsService = new google.maps.DirectionsService();
    	  
    	 directionsDisplay = new google.maps.DirectionsRenderer();
    	 directionsDisplay.setMap(map);
    	 directionsService.route(request, function(result, status) {
    		    if (status == google.maps.DirectionsStatus.OK) {
    		      console.log("route. " +result);
    		      directionsDisplay.setDirections(result);
    		    }else{

    		       console.log("route failed. status:" +status +" result:" +result);
    		    }
    		  });
    }
    google.maps.event.addDomListener(window, 'load', initializeMap);
    
    //write selected text in our input field to make it look nicer
    //could disable the input field as well
	$("#zielAdresseFormSelect").click(function(){
		var selectedText = $("#zielAdresseFormSelect :selected").text();
		if(selectedText !== "Bitte auswählen."){
			$("#zielAdresseForm").val(selectedText);
		}
	});
    
	$("#startAdresseFormSelect").click(function(){
		var selectedText = $("#startAdresseFormSelect :selected").text();
		if(selectedText !== "Bitte auswählen."){
			$("#startAdresseForm").val(selectedText);
		}
	});
	$("#startAdresseForm").change(function(){
		$("#startAdresseFormSelect").val(this.getAttribute("Bitte auswählen."));
	});
	$("#zielAdresseForm").change(function(){
		$("#zielAdresseFormSelect").val(this.getAttribute("Bitte auswählen."));
	});
	
    //set counter for additional waypoints
    var counter = 0;
    $("#wegPunkteHinzufuegen").click(function(){
    	counter += 1;
    	var html = $("#wegpunkte").html();
    	html += '<div class="clearfix form-group"><label for="wegpunkte'+counter+'">Über</label>';
    	html += '<div class="input"><input class="form-control" name="wegpunkte'+counter+'" id="wegpunkte'+counter+'" type="text" placeholder="Über Adresse"></div>';
    	html += '<span class="help-block">Required</span></div>';
    	$("#wegpunkte").html(html);

    });

    function placeMarker(location, map) {
      var marker = new google.maps.Marker({
          position: location,
          map: map
      });
    }

    </script>
}